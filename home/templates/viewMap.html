{% extends 'base_map_1.html' %}
{% load static%} {% block content %}
<style>
    table,
    th,
    td {
        border-bottom: 1px solid #ddd;
        border-collapse: collapse;
        padding: 2px 3px;
        text-align: center;
    }
    
    th {
        font-weight: bold;
    }
    
    tr:hover {
        background-color: #c9dbe6;
    }
    
    #checkboxes {
        display: none;
        /* border: 1px #dadada solid; */
    }
    
    .slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 25px;
        background: #D3D3D3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }
    
    .slider:hover {
        opacity: 1;
    }
    
    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        background: #FF0000;
        cursor: pointer;
    }
    
    .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        background: #FF0000;
        cursor: pointer;
    }
    
    .sliderticks {
        display: flex;
        justify-content: space-between;
        padding: 0 10px;
    }
    
    .sliderticks p {
        position: relative;
        display: flex;
        justify-content: center;
        text-align: center;
        width: 1px;
        background: #D3D3D3;
        height: 10px;
        line-height: 40px;
        margin: 0 0 20px 0;
    }
    
    input[type="range"]::-moz-range-track {
        padding: 0 10px;
        background: repeating-linear-gradient(to right, #ccc, #ccc 10%, #000 10%, #000 11%, #ccc 11%, #ccc 20%);
    }
    
    #checkboxes3 label {
        display: block;
        text-align: left;
        margin: 10px;
    }
    
    #checkboxes3 {
        display: none;
        /* border: 1px #dadada solid; */
    }
    
    #checkboxes label {
        display: block;
        text-align: left;
        margin: 10px;
    }
    /* #checkboxes label:hover {
  background-color: #1e90ff;
} */
    
    #checkboxes2 label {
        display: block;
        text-align: left;
        margin: 10px;
    }
    
    #checkboxes2 {
        display: none;
        /* border: 1px #dadada solid; */
    }
    
    .btn {
        margin: 10px;
    }
    
    .border {
        padding: 6px 8px;
        border-style: groove;
        border-radius: 5px;
        margin: 20px;
    }
    
    .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
    }
    
    .info h4 {
        margin: 0 0 5px;
        color: #777;
    }
    
    .table {
        border-collapse: collapse;
        padding: 50px;
        font-weight: bold;
        /* background:rgba(191, 149, 233, 0.473); */
    }
    /* css to customize Leaflet default styles  */
    
    .leaflet-popup-content-wrapper {
        background: rgba(0, 0, 0, 0.9);
        color: #ffffff;
    }
    
    .leaflet-popup-content {
        font-weight: bold;
    }
    
    h6 {
        color: blue;
    }
    
    .select {
        background-color: rgb(116, 109, 109);
        width: 40%;
        margin-left: 100px;
        ;
        color: white;
    }
    
    .select.highlight {
        background: rgb(0, 0, 0);
        color: white;
    }
    
    .circle {
        background-color: red;
        border-radius: 50%;
    }
    
    .table-legend {
        border-collapse: collapse;
        padding: 2px 3px;
        width: 100%;
        font-size: small;
        /* font-weight: bold; */
        background: #fff;
    }
    
    .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
    }
    
    .info h4 {
        margin: 0 0 5px;
        color: #777;
    }
    
    .legend {
        line-height: 18px;
        color: #555;
    }
    
    .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.7;
    }
</style>

<div id="side-bar" style="background-color: rgba(255, 255, 255);">
    <!-- side-bar container -->


    <div class="mobileShow">

        <div style="text-align: center">
            <button style="display: inline-block ;position: relative; background: #000; opacity: 0.60;" id="closebutton" name="closebutton" class="btn btn-secondary"><span class="fa fa-bars"></span></button>
        </div>

    </div>
    <div class="border">
        {% csrf_token %}
    <form method="POST" id="post-form">
        <div class="tooltips" title="Please select the District">
              <select name="district" class='form-control' id = "district">
                <option value="Select District"> Select District</option>
                {% for i in district %}
                <option value="{{ i.district }}">{{ i.district }}</option>
                {% endfor %}
               </select>
        </div> 
        
     

       <div class="tooltips" title="Please select the Maharashtra's Blocks" id="block">
        &nbsp;&nbsp;
            <select name="taluka" class='form-control' id="block_s">
              <option value="Select Taluka"> Select Taluka </option>
              {% for i in taluka %}
              <option value="{{ i.block_n }}">{{ i.block_n }}</option>
              {% endfor %}
             </select>
      </div> 
      <!-- <button type="submit" class="btn btn-primary">ddd</button> -->

    
    </div>
    <div style="margin:20px" class="border"> 
        <select name="agan_type" class='form-control' id = "agan_type">
            <option value="">Select type of Aganwadi</option>
            <option value="मुख्य">मुख्य</option>
            <option value="मिनी">मिनी</option>
        </select>

        {% comment %} <p>Please select type of Aganwadi</p>
        <input type="radio" id="agan_main" class="agan_type" name="agan_type" value="मुख्य">
        <label for="html">मुख्य</label><br>
        <input type="radio" id="agan_mini" class="agan_type" name="agan_type" value="मिनी">
        <label for="css">मिनी</label><br> {% endcomment %}
    
    </div>
    <div class="border">
        <div class="tooltips mb-3" title="Please select the Construction Type">
            <select name="constr" class='form-control' id = "construction">
              <option value=""> Select AWC Construction Type</option>
              <option value="अंगणवाडी इमारत नाही आहे">अंगणवाडी इमारत नाही आहे</option>
              <option value="कच्चे">कच्चे</option>
              <option value="पक्के">पक्के</option>
              {% comment %} <option value="d">d</option> {% endcomment %}
             </select>
      </div> 
      <div class="tooltips" title="Please select the Angan">
        <select name="sitangan" class='form-control' id = "sitangan">
          <option value=""> Select Child Sit Angan</option>
          <option value="01-01-2020">01-01-2020</option>
          <option value="२१-४०">२१-४०</option>
          <option value="४१-६०">४१-६०</option>
          <option value="६०+">६०+</option>
         </select>
  </div> 
    </div>
    <!-- <button onclick="funct()" class="btn btn-primary">Plot Data</button> -->
    <button type="submit" id="fs" class="btn btn-primary">Plot Data</button>

</form>
    
    <!-- <button onclick="plotData()" id="plot-data"class="btn btn-primary">Plot Data</button> -->
    <button onclick="download()" id="down-data"class="btn btn-primary">Download Data</button>
    <button onclick="clearAll()" id="clear-data"class="btn btn-primary">Clear All</button>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
    let isClicked = false
    
    var icon1 = L.icon({
        iconUrl:  "{% static 'map/pinmargerblue.png' %}",
        iconSize:     [30, 30], // size of the icon
        //shadowSize:   [50, 64], // size of the shadow
        iconAnchor:   [25,10], // point of the icon which will correspond to marker's location
        // shadowAnchor: [4, 62],  // the same for the shadow
        popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
    });
    
    var awcLayer = L.layerGroup().addTo(mymap);
    // awcLayer.addTo(mymap);
    
    </script>
      <style>
      .another-popup .leaflet-popup-content-wrapper .leaflet-popup-content{
          width: 400px;
          height:auto;
        }
    
      </style>

      <script>

var points=[];
var districtLayer;
var talLayer;

var Raigad = [ 'Select Taluka', 'Pen','Alibag','Murud','Panvel','Uran','Karjat','Khalapur','Mangaon']
var Ratnagiri = ['Select Taluka','Ratnagiri','Sangameshwar','Lanja','Rajapur ','Chiplun','Guhagar','Dapoli','Mandangad','Khed']
var Sindhudurg = ['Select Taluka','Kankavli','Vaibhavwadi','Devgad','Malwan','Sawantwadi','Kudal','Vengurla','Dodamarg (Kasal)']
var Palghar = ['Select Taluka','Palghar','Vasai','Dahanu','Talasari','Jawhar','Mokhada','Vada','Vikramgad']
var nashik  = ['Select Taluka', 'Nashik','Igatpuri','Dindori','Peth','Trimbakeshwar','Kalwan','Deola','Surgana','Baglan(Satana)','Malegaon','Nandagaon','Chandwad','Niphad','Sinnar','Yeola']
var Nandurbar = ['Select Taluka', 'Nandurbar','Navapur','Shahada','Talode','Akkalkuwa','Akrani(Dhadgaon)']
var Dhule= ['Select Taluka', 'Dhule','Sakri','Sindkheda','Shirpur']
var mumbai_suburb = ['Select Taluka','Kurla','Mulund','Andheri','Borivali']
var Mumbai_City = ['Select Taluka','Mumbai']
var Jalgaon = ['Select Taluka', 'Jalgaon','Jamner','Erandol','Dharangaon','Bhusawal','Raver','Muktainagar','Yawal','Amalner','Parola','Chopda','Pachora','Bhadgaon','Chalisgaon']
var Buldhana = ['Select Taluka', 'Buldhana','Chikhli','Deulgaon','Jalgaon Jamod','Sangrampur','Malkapur','Motala','Nandura','Khamgaon','Shegaon','Mehkar','Sindkhed Raja','Lonar']
var Akola = ['Select Taluka', 'Akola','Akot','Telhara','Patur','Murtajapur','Barshitakli']
var Washim = ['Select Taluka', 'Wahim','Malegaon','Risod','Mangrulpir','Karanja','Manora']
var Thane=['Select Taluka','Thane','Kalyan','Murbad','Bhiwandi','shahapur','Ulhasnagar','Ambarnath']
var amravati = ['Select Taluka', 'Amravati','Bhatukali','Nandgaon Khandeshwar','Dharni (Amravati)','Chikhaldara','Achalpur','Chandurbazar','Morshi','Warud','Daryapur','Anjangaon-Surji','Chandur','Dhamangaon','Tiosa']
var Wardha = ['Select Taluka', '	Wardha','Deoli','Seloo','Arvi','Ashti','Karanja','Hinganghat','Samudrapur']
var nagpur = ['Select Taluka', 'Nagpur','Kamptee','Hingna','Katol','Narkhed','Savner','Kalameshwar','Ramtek','Mouda','Parseoni','Umred','Kuhi','Bhiwapur']
var Bhandara = ['Select Taluka', 'Bhandara','Tumsar','Pauni','Mohadi','Sakoli','Lakhni','Lakhandur']
var Gondia = ['Select Taluka', 'Gondia','Tiroda','Goregaon','Arjuni Morgaon','Amgaon','Salekasa','Sadak Arjuni ','Deori']
var gadchiroli = ['Select Taluka', 'Gadchiroli','Dhanora','Chamorshi','Mulchera','Desaiganj (Vadasa)','Armori','Kurkheda','Korchi','Korchi','Bhamragad','Sironcha']
var Chandrapur = ['Select Taluka', 'Chandrapur','Saoli','Mul','Ballarpur','Pombhurna','Gondpimpri','Warora','Chimur','Bhadravati','Bramhapuri','Nagbhid ','Sindewahi','Rajura','Korpana','Jivati']
var Yavatmal = ['Select Taluka', 'Yavatmal','Arni','Babhulgaon','Kalamb','Darwha','Digras','Ner','Pusad','Umarkhed','Mahagaon','Kelapur (Pandharkawada)','Ralegaon','Ghatanji','Wani','Maregaon','Zari Jamani']
var Nanded = ['Select Taluka', 'Nanded','Ardhapur','Mudkhed','Bhokar','Umri','Loha','Kandhar','Kinwat','Himayatnagar','Hadgaon','Mahur','Deglur','Mukhed','Dharmabad','Biloli','Naigaon (Khairgaon)']
var Hingoli = ['Select Taluka', 'Hingoli','Sengaon','Kalamnuri','Basmath','Aundha Nagnath']
var Parbhani = ['Select Taluka', 'Parbhani','Sonpeth','Gangakhed','Palam','Purna','Sailu','Jintur','Manwath','Pathri']
var Jalna = ['Select Taluka', 'Jalna','Bhokardan','Jafrabad','Badnapur','Ambad','Ghansawangi','Partur','Mantha']
var aurangabad = ['Select Taluka', 'Aurangabad','Kannad','Soegaon','Sillod','Phulambri','Khuldabad','Vaijapur','Gangapur','Paithan']
var Beed= ['Select Taluka', 'Beed','Ashti','Patoda','Shirur-Kasar','Georai','Majalgaon','Wadwani','Kaij','Dharur','Parli','Ambejogai']
var Latur = ['Select Taluka', 'Latur','Renapur','Ahmedpur','Jalkot','Chakur','Shirur Anantpal','Ausa','Nilanga','Deoni','	Udgir',]
var Osmanabad = ['Select Taluka', 'Osmanabad','Tuljapur','Bhum','Paranda','Washi','Kalamb','Lohara','Umarga']
var Solapur_North = ['Select Taluka', 'Solapur North','Barshi','Solapur South','Akkalkot','Madha','Karmala','Pandharpur','Mohol','Malshiras','Sangole','Mangalvedhe']
var Ahmadnagar = ['Select Taluka', 'nagar','Shevgaon','Pathardi','Parner','Sangamner','Kopargaon','Akola','Shrirampur','Nevasa','Rahata','Rahuri','Shrigonda ','Karjat','Jamkhed']
var pune = ['Select Taluka', 'Pune City','Haveli','Haveli - PCMC, PCMC','Khed (Rajgurunagar)','Junnar','Ambegaon (Ghodegaon)','Maval (Vadgaon)','Mulshi (Paud)','Shirur','Purandhar (Saswad)','Velhe','Bhor','Baramati','Indapur','Daund']
var Satara = ['Select Taluka', 'Satara','Jaoli','Koregaon','Wai','Mahabaleshwar','Khandala','Phaltan','Maan (Dahiwadi)','Khatav (Vaduj)','Patan','Karad']
var Sangli = ['Select Taluka', 'Miraj','Kavathe-Mahankal','Tasgaon','Jat','Walwa (Islampur)','Shirala','Khanapur-Vita ','Atpadi','Palus','Kadegaon']
var Kolhapur = ['Select Taluka', 'Karvir','Panhala','Shahuwadi','Kagal','Hatkanangale','Shirol','Radhanagari','Gaganbawada','Bhudargad','Gadhinglaj','Chandgad','Ajra']


const download = ()=>{
    const rows = [['awc_code','district','project','beat','latitude','longitude','altitude','accuracy','objectid','st_code','st_name','dist_code','dist_name','ac_no','ac_name','start','end','division','district_1','project_2','Beat_3','Anganwadi_4','agan_type','agancbuil_const','aganc_forrent','yes_moveagan_govpre','no_owner_agancbuil','child_sitagan','child_weigh_material','child_weigh_mat_working','adult_wtequip','adult_wteq_working','infant_meter','infant_meter_working','stadiometer','stadm_working','maint_repair_need','agan_drinkwat_avail','agan_tap','plumb_workcond','toil_fac','toil_working','electricity_connection','solar_powersupply','agan_tv','tv_working','agan_fenc','agan_back_gard','space_own_garden','vac_agan','post_vac','post_vac_aw_worker','post_vac_help','pro_fill_agan_post','child0_6monage','child6mon_3yr','child3 _6yrs','tot_no_child','preg_moth_agan','brestfeed_moth_agan','preg_lact_moth','aadh_notlinknuttrack','preg_lact_mothaadh_notlinked_nuttrack','child_weigh_meas_agan_mar22','child_heigh_meas_agan_mar22','no_suv_child_agan_Jan_mar22','no_suv_child_recthr_jan_mar22','child_sam_agan_jan_mar22','child_rec_vcdc_fac','sam_child_agan_vcdc_jan_mar22','sam_agan_nrc_jan_mar22','no_adol_girl_dropsch_agan','child_agan_sch_engl_priv_nurs','ifyes_childenrol_agan_sch_priv_nurs_engl','agan_rec_migr_bene','bene_agan_migr_indist','agan_bene_migr_outdist','benetot_migr_out','migrbenetot_agancentarea','agan_serv_migr_outaganarea','ifyes_aganspen10pergdp_endmar22','ifyes_gp_spent_10pergdp_endmarch22','aay','totno_child_serv_aay_6mon_6yrs','preg_lact_mother_serv_aay_ecd','parvisit_inibalasch','parent_visit_past_year','balasch','agan_und_balasch','work_comund_balasch_mar22','ifcom_ongo_task_comp_undbalasch','ifcom_ongo_task_comp_undbalasch1','ifcom_ongo_task_comp_undbalasch_sandpit','ifcom_ongo_task_comp_undbalasch_lawn','ifcom_ongo_task_comp_undbalasch_display','ifcom_ongo_task_comp_undbalasch_writboar','sign_sup_chserv','sign_sup_headmisurl','_id','_uuid','_submission_time','_validation_status','_notes','_status','_submitted_by','_tags','_index']]
    for(point of points){
        const row=[]
        for(attr in point.data){
            row.push(point.data[attr])
        }
        rows.push(row);
        
    }
    console.log(rows[0]);
    
    
    let csvContent = "data:text/csv;charset=utf-8," 
    + rows.map(e => e.join(",")).join("\n");

    var encodedUri = encodeURI(csvContent);
    var link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "my_data.csv");
    document.body.appendChild(link); // Required for FF

    link.click();
}

$("#district").change(function(){
    //document.getElementById('post-form').submit()
    document.getElementById('fs').click()
    DistrictSelected = $(this).val();
    var optionsList;
    var htmlString = "";
  
    districtLayer = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
            layers: '	geonode:maharashtra_districts',
            format: 'image/png',
            transparent: 'true',
            cql_filter:`district='${DistrictSelected}'`,
          });
          districtLayer.addTo(mymap);
  
    switch (DistrictSelected) {
      case "Raigad":
          optionsList = Raigad;
          break;
      case "Ratnagiri":
          optionsList = Ratnagiri;
          break;
      case "Sindhudurg":
          optionsList = Sindhudurg;
          break;
      case "mumbai_suburb":
          optionsList = mumbai_suburb;
          break;
      case "Mumbai City":
          optionsList = Mumbai_City;
          break;
      case "Thane":
          optionsList = Thane;
          break;
      case "Palghar":
          optionsList = Palghar;
          break;
      case "Nashik":
          optionsList = nashik;
          break;
      case "Nandurbar":
          optionsList = Nandurbar;
          break;
      case  "Dhule":
          optionsList = Dhule;
          break;
      case "Jalgaon":
          optionsList = Jalgaon;
          break;
      case "Buldhana":
          optionsList = Buldhana;
          break;
      case "Akola":
          optionsList = Akola;
          break;
      case "Washim":
          optionsList = Washim;
          break;
      case  "Amravati":
          optionsList = amravati;
          break;
      case "Wardha":
          optionsList = Wardha;
          break;
      case  "Nagpur":
          optionsList = nagpur;
          break;
      case "Bhandara":
          optionsList = Bhandara;
          break;
      case  "Gondia":
          optionsList = Gondia;
          break;
      case "Gadchiroli":
          optionsList = gadchiroli;
          break;
      case  "Chandrapur":
          optionsList = Chandrapur;
          break;
      case "Yavatmal":
          optionsList = Yavatmal;
          break;
      case  "Nanded":
          optionsList = Nanded;
          break;
      case "Hingoli":
          optionsList = Hingoli;
          break;
      case  "Parbhani":
          optionsList = Parbhani;
          break;
      case "Jalna":
          optionsList = Jalna;
          break;
      case  "Aurangabad":
          optionsList = aurangabad;
          break;
      case  "Beed":
          optionsList = Beed;
          break;
      case "Latur":
          optionsList = Latur ;
          break;
      case  "Osmanabad":
          optionsList = Osmanabad;
          break;
      case  "Solapur_North":
          optionsList = Solapur_North;
          break;
      case "Ahmadnagar":
          optionsList = Ahmadnagar;
          break;
      case  "Pune":
          optionsList = pune;
          break;
      case "Satara":
          optionsList = Satara;
          break;
      case  "Sangli":
          optionsList = Sangli;
          break;
      case "Kolhapur":
          optionsList = Kolhapur;
          break;
  
  }
  
  // console.log(optionsList)
    for(var i = 0; i < optionsList.length; i++){
      htmlString = htmlString+"<option value='"+ optionsList[i] +"'>"+ optionsList[i] +"</option>";
    }
    $("#block_s").html(htmlString);

    
  
  });

$('#block_s').change(function(){
    putWMSLayertaluka();
    document.getElementById('fs').click()
    //document.getElementById("post-form").submit();
})

$('#agan_type').change(function(){
    //formSubmit()
    document.getElementById('fs').click()
})

$('#construction').change(function(){
    //putWMSLayertaluka();
    document.getElementById('fs').click()
    //document.getElementById("post-form").submit();
})

$('#sitangan').change(function(){
    //putWMSLayertaluka();
    document.getElementById('fs').click()
    //document.getElementById("post-form").submit();
})

function setView(layerName, selectedBoundary) {
    // if (area) {
    //     mymap.removeLayer(area);
    // }
    let rootUrl = 'https://geonode.communitygis.in/geoserver/geonode/ows';

    let options = {
        service: 'WFS',
        version: '1.0.0',
        request: 'GetFeature',
        outputFormat: 'application/json',
        typeName: layerName,
        cql_filter: `Block='${selectedBoundary}'`,
        propertyName: 'the_geom'
    };
    let parameters = L.Util.extend(options);
    layer_url = rootUrl + L.Util.getParamString(parameters)
    fetch(layer_url).then(
        function(response) {
            if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' +
                    response.status);
                return;
            }
            response.json().then(function(geojsonData) {
                //area = L.geoJson(geojsonData.features).addTo(mymap)
                area = L.geoJson(geojsonData.features)
                lat = area.getBounds()._northEast.lat
                lng = area.getBounds()._northEast.lng
                mymap.setView([lat, lng - 0.4], 10)
            });
        }).catch(function(err) {
        console.log('Fetch Error :-S', err);
    });
}

function setViewByDistrict(layerName, state,district) {
    // if (area) {
    //     mymap.removeLayer(area);
    // }
    alert(layerName+state+district);
    var area = null
    let rootUrl = 'https://geonode.communitygis.in/geoserver/geonode/ows';

    let options = {
        service: 'WFS',
        version: '1.0.0',
        request: 'GetFeature',
        outputFormat: 'application/json',
        typeName: layerName,
        cql_filter: `District='${district}'`,
        propertyName: 'the_geom'
    };
    let parameters = L.Util.extend(options);
    layer_url = rootUrl + L.Util.getParamString(parameters)

    fetch(layer_url).then(
        function(response) {
            if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' +
                    response.status);
                return;
            }
            response.json().then(function(geojsonData) {
                area = L.geoJson(geojsonData.features)
                lat = area.getBounds()._northEast.lat
                lng = area.getBounds()._northEast.lng
                mymap.setView([lat - .5, lng - 0.9], 9)
            });
        }).catch(function(err) {
        console.log('Fetch Error :-S', err);
    });
}
  
function putWMSLayerdist() {
    var dist = document.getElementById('district').value;
    var state = 'Maharashtra';
    var layers = 'geonode:MH_block0';
    console.log(dist);
    //var stLayerLatLong= listState[indstate];
    if (dist == 'Mumbai City' || dist == 'Mumbai Suburban')
        mymap.setView([19.0760, 72.8777], 11);
    if (state == "Chhattisgarh") {
        layers = 'geonode:all_india_districts_11june2020';
    }
    //clear_distlayer();
    //clear_tallayer();
    var wms_layer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
        layers: 'MH_block0',
        format: 'image/png',
        transparent: 'true',
        // version: '1.3.0',
        // cql_filter: `district='${dist}' AND state='${state}'`,
        cql_filter: `District='${dist}'`,
        style: ""
    });
    console.log(wms_layer);
    //clear_layer();
    //clearpoint_layer();
    wms_layer.addTo(mymap);
    setViewByDistrict('geonode:MH_block0', state,dist);

    //mymap.setView([stLayerLatLong[1],stLayerLatLong[2]],8);
    distLayerList.push(wms_layer);
    addWMSLegend(layers);


}

  function putWMSLayertaluka() {
    // clear_tallayer();
    var dist = document.getElementById('district').value;
    var taluka = document.getElementById('block_s').value;

    var wms_layer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
        layers: "geonode:MH_block0",
        // cql_filter: "taluka_nam='" + taluka + "'",
        cql_filter: `Block='${taluka}' AND District='${dist}'`,
        format: 'image/png',
        transparent: 'true',
        style: "color:red",
    });
    // clear_layer();
    //clear_tallayer();
    // console.log(wms_layer);
    wms_layer.addTo(mymap);
    setView('geonode:MH_block0', taluka);
    
    talLayer=wms_layer;
    // console.log(taluka);    


}

var d;

$(document).ready(
    $('#post-form').submit(async function(e){
        e.preventDefault();
        var serializedData = $(this).serialize();
        console.log('hjkhjh');

        $.ajax({
            type:"POST",
            url: "{% url 'map' %}",
            dataType: 'json',
            data: serializedData,
            success: function(data){
                console.log("data")
                d = JSON.parse(data["data"])
                plotData()   
            }
        })
        console.log(' belowhjkhjh');
    })
)

function formSubmit(){
    document.getElementById("post-form").submit();
}


function plotData(){
    //for(x in d){
    //    console.log(d[x].fields.latitude)
    //}
    console.log("pltdata called")
    replot()
    for(x in d){
        var point = L.marker([d[x].fields.latitude,d[x].fields.longitude],{icon:icon1});
        point.addTo(mymap)
        point.data=d[x].fields;
        point.bindPopup(`<div><img src="${d[x].fields}"><br>District: ${d[x].fields.district}<br>Taluka: ${d[x].fields.block_n}<br>Anganwadi Type: ${d[x].fields.agan_type}<br>Construction: ${d[x].fields.agancbuil_field}<br>Sitangan: ${d[x].fields.child_sitagan}</div>`)
        points.push(point)
    }
}

function clearAll(){
    points.forEach(p=>{
        mymap.removeLayer(p)
    })
    points=[]
    if(districtLayer){
        mymap.removeLayer(districtLayer)
    }
    if(talLayer){
        mymap.removeLayer(talLayer)
    }
}

function replot(){
    points.forEach(p=>{
        mymap.removeLayer(p)
    })
    points=[]
    
}

function funct(){
    console.log('sfsdfsdf')
    document.getElementById('post-form').submit()

}

      </script>

    
    
  {% endblock %}
